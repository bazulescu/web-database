
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="c3ad1b70-2a29-5d4b-a7be-410b34d2fc6c")}catch(e){}}();
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[36907],{9055:(e,t,l)=>{"use strict";l.d(t,{A:()=>o});var n=l(467926),i=l(535478),a=l(400443);class s extends i.Component{static{this.propTypes={children:a.node,className:a.string}}render(){let{children:e,innerRef:t,...l}=this.props;return(0,n.jsx)("tr",{...l,ref:t,children:i.Children.map(e,(e,t)=>e?(0,i.cloneElement)(e,{column:t,tagName:"th"}):null)})}}let o=s},9573:e=>{e.exports={scroller:"scroller_scroller__BjCJR",buttons:"scroller_buttons___hSWc",overlayContainer:"scroller_overlayContainer__QxJO1",isHorizontal:"scroller_isHorizontal__lzvHV",overlay:"scroller_overlay__oUdFH",top:"scroller_top__tmDxF",left:"scroller_left__f6lGq",right:"scroller_right__Uv7dw",bottom:"scroller_bottom__9bnaV"}},55034:(e,t,l)=>{"use strict";l.d(t,{LI:()=>d,OL:()=>r,UL:()=>o});var n=l(467926),i=l(469916),a=l(111887),s=l.n(a);let o=({children:e,className:t})=>(0,n.jsx)("ul",{className:(0,i.$)(s().ul,t),children:e}),r=({children:e,className:t})=>(0,n.jsx)("ol",{className:(0,i.$)(s().ol,t),children:e}),d=({children:e,className:t})=>(0,n.jsx)("li",{className:(0,i.$)(s().li,t),children:e})},111887:e=>{e.exports={ul:"list_ul__hxN2r",ol:"list_ol__hnCT8",li:"list_li__q6Ta7"}},112758:(e,t,l)=>{"use strict";function n(e,t){return t&&t.type===e}l.d(t,{A:()=>n})},122680:(e,t,l)=>{"use strict";l.d(t,{_u:()=>h,wD:()=>p,wf:()=>u});var n=l(535478),i=l(42227),a=l(215790),s=l(294553),o=l(528443),r=l(360968),d=l(101920),c=l(404019);function u({deploymentId:e,teamId:t},l){return(0,s.f)(e?function({deploymentId:e,teamId:t}){return`${(0,d.SyP)("v2")}/${e}/aliases${(0,o.l)({teamId:t})}`}({deploymentId:e,teamId:t}):null,l)}function h(e,t){return(0,i.Ay)(()=>{if(!e)return null;let{team:t,id:l,teamId:n}=e;return`${(0,d.SyP)("v2")}/${l}/aliases${(0,o.l)({teamId:n??(t?t.id:null)})}`},e=>(0,r.ff)(e,{throwOnHTTPError:!0}),t)}function p({limit:e=20,domains:t,rollbackDeploymentId:l},i){let{isReady:s,team:o}=(0,c.dA)(),u=(0,a.Ay)((n,i)=>{if(!s)return null;let a=`${d.a4Q}`,r=t?.map(e=>`domain=${encodeURIComponent(e)}`).join("&")||null;if(!n)return`${a}${m({limit:e+1,teamId:o?.id,rollbackDeploymentId:l},r)}`;let c=i?.aliases&&i.aliases.length>e?i.aliases[e-1].createdAt:null;return c?`${a}${m({limit:e+1,teamId:o?.id,until:c},r)}`:null},e=>(0,r.ff)(e,{throwOnHTTPError:!0}),i),h=(0,n.useMemo)(()=>u.data?[].concat(...u.data.filter(Boolean).map(t=>t.aliases.slice(0,e))):[],[u.data,e]),p=!!u.data&&!u.error,x=!!(u.data&&0===h.length),g=!!(u.data&&u.size>u.data.length),b=!!(u.data&&u.data[u.data.length-1]?.aliases.length<=e);return[u,{aliases:h,initialDataLoaded:p,isEmpty:x,loadMore:()=>u.setSize(e=>e+1),isLoadingMore:g,isReachingEnd:b}]}function m(e,t){let l=(0,o.l)(e,!1),n=t?`&${t}`:"";return l?`?${l}${n}`:`?${n}`}},129470:(e,t,l)=>{"use strict";l.d(t,{H:()=>n});let n=(0,l(239665).G)('<path fill-rule="evenodd" clip-rule="evenodd" d="M7.70059 1.73618L7.74488 1.5H8.2551L8.29938 1.73618C8.4406 2.48936 8.98357 3.04807 9.63284 3.27226C9.82296 3.33791 10.008 3.41476 10.1871 3.50207C10.805 3.80328 11.5845 3.7922 12.2172 3.35933L12.4158 3.22342L12.7766 3.5842L12.6407 3.78284C12.2078 4.41549 12.1967 5.19496 12.4979 5.81292C12.5852 5.99203 12.6621 6.17703 12.7277 6.36714C12.9519 7.01642 13.5106 7.55938 14.2638 7.7006L14.5 7.74489V8.25511L14.2638 8.2994C13.5106 8.44062 12.9519 8.98359 12.7277 9.63286C12.6621 9.82298 12.5852 10.008 12.4979 10.1871C12.1967 10.805 12.2078 11.5845 12.6407 12.2172L12.7766 12.4158L12.4158 12.7766L12.2172 12.6407C11.5845 12.2078 10.805 12.1967 10.1871 12.4979C10.008 12.5852 9.82296 12.6621 9.63284 12.7277C8.98357 12.9519 8.4406 13.5106 8.29938 14.2638L8.2551 14.5H7.74488L7.70059 14.2638C7.55937 13.5106 7.0164 12.9519 6.36713 12.7277C6.17702 12.6621 5.99202 12.5852 5.8129 12.4979C5.19495 12.1967 4.41548 12.2078 3.78283 12.6407L3.5842 12.7766L3.22342 12.4158L3.35932 12.2172C3.79219 11.5845 3.80326 10.8051 3.50206 10.1871C3.41475 10.008 3.3379 9.82298 3.27225 9.63285C3.04806 8.98358 2.48935 8.44061 1.73616 8.29939L1.5 8.25511V7.74489L1.73616 7.70061C2.48935 7.55939 3.04806 7.01642 3.27225 6.36715C3.3379 6.17703 3.41475 5.99203 3.50205 5.81291C3.80326 5.19496 3.79218 4.41549 3.35931 3.78283L3.2234 3.5842L3.58418 3.22342L3.78282 3.35932C4.41547 3.79219 5.19494 3.80327 5.8129 3.50207C5.99201 3.41476 6.17701 3.33791 6.36713 3.27226C7.0164 3.04807 7.55937 2.48936 7.70059 1.73618ZM6.49999 0H9.49999L9.77369 1.45974C9.80837 1.64472 9.94454 1.79299 10.1224 1.85441C10.3702 1.93996 10.6111 2.04007 10.8443 2.15371C11.0135 2.2362 11.2148 2.22768 11.3701 2.12137L12.5962 1.28249L14.7175 3.40381L13.8786 4.62987C13.7723 4.78525 13.7638 4.98647 13.8463 5.1557C13.9599 5.38885 14.06 5.62981 14.1456 5.87756C14.207 6.05545 14.3553 6.19161 14.5402 6.2263L16 6.5V9.5L14.5402 9.7737C14.3553 9.80839 14.207 9.94455 14.1456 10.1224C14.06 10.3702 13.9599 10.6112 13.8463 10.8443C13.7638 11.0135 13.7723 11.2148 13.8786 11.3701L14.7175 12.5962L12.5962 14.7175L11.3701 13.8786C11.2147 13.7723 11.0135 13.7638 10.8443 13.8463C10.6111 13.9599 10.3702 14.06 10.1224 14.1456C9.94454 14.207 9.80837 14.3553 9.77369 14.5403L9.49999 16H6.49999L6.22628 14.5403C6.1916 14.3553 6.05544 14.207 5.87755 14.1456C5.6298 14.06 5.38884 13.9599 5.15569 13.8463C4.98645 13.7638 4.78523 13.7723 4.62985 13.8786L3.40381 14.7175L1.28249 12.5962L2.12136 11.3702C2.22767 11.2148 2.23619 11.0136 2.1537 10.8443C2.04006 10.6112 1.93995 10.3702 1.8544 10.1224C1.79297 9.94455 1.6447 9.80838 1.45973 9.7737L0 9.5V6.5L1.45973 6.2263C1.6447 6.19162 1.79297 6.05545 1.8544 5.87756C1.93995 5.62981 2.04005 5.38885 2.1537 5.15569C2.23619 4.98646 2.22766 4.78524 2.12135 4.62986L1.28247 3.40381L3.40379 1.28249L4.62984 2.12136C4.78522 2.22767 4.98644 2.2362 5.15568 2.15371C5.38883 2.04007 5.6298 1.93996 5.87755 1.85441C6.05544 1.79299 6.1916 1.64472 6.22628 1.45975L6.49999 0ZM9.49998 8C9.49998 8.82843 8.82841 9.5 7.99998 9.5C7.17156 9.5 6.49998 8.82843 6.49998 8C6.49998 7.17157 7.17156 6.5 7.99998 6.5C8.82841 6.5 9.49998 7.17157 9.49998 8ZM11 8C11 9.65685 9.65684 11 7.99998 11C6.34313 11 4.99998 9.65685 4.99998 8C4.99998 6.34315 6.34313 5 7.99998 5C9.65684 5 11 6.34315 11 8Z" fill="currentColor"/>')},192864:(e,t,l)=>{"use strict";l.d(t,{A:()=>i});var n=l(858826);function i(e){return(0,n.A)(e)?e.slice(2):e}},218702:e=>{e.exports={"rollback-modal":"rollback-modal_rollback-modal__wr8oC","warning-list":"rollback-modal_warning-list__COWQr","alias-list":"rollback-modal_alias-list__vuz4n","deployment-link":"rollback-modal_deployment-link__8AsHl"}},249863:(e,t,l)=>{"use strict";l.d(t,{A:()=>m});var n=l(467926),i=l(841095),a=l(778950),s=l(38834),o=l(919186),r=l(529756),d=l(216970),c=l(309486),u=l(507573);function h({hidden:e,showIcon:t=!0,linkProps:l,defaultRoute:i}){return(0,n.jsx)(n.Fragment,{children:e.map(e=>(0,n.jsx)("div",{children:(0,n.jsx)(c.A,{defaultRoute:i,icon:t,title:e,truncate:!0,url:e,...l})},e))})}function p({hidden:e,linkProps:t}){let l=(0,r.Ub)(690);return void 0===l?null:l?(0,n.jsx)(d.A,{anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},trigger:(0,n.jsx)(s.E,{variant:"gray-subtle",children:`+${e.length}`}),children:(0,n.jsx)(u.W,{style:{position:"relative",top:"20px"},tipOffset:4,tipSide:"right",width:"300px",children:(0,n.jsx)(i.B,{style:{maxHeight:"210px",overflow:"scroll",padding:"0 8px",fontWeight:400},children:(0,n.jsx)(h,{hidden:e,linkProps:t})})})}):(0,n.jsx)(o.Tooltip,{text:(0,n.jsx)(h,{hidden:e,linkProps:t}),children:(0,n.jsx)(s.E,{size:"sm",variant:"gray-subtle",children:`+${e.length}`})})}let m=function({className:e,defaultRoute:t,domains:l,firstOnly:s,showIcon:o=!0,style:r,linkProps:d}){if(!l)return(0,n.jsx)(a.E,{as:"span",className:e,color:"gray-900",style:r,weight:400,children:"-"});let{visible:u,hidden:h}=l.reduce((e,t)=>(0===e.visible.length||!s&&1===e.visible.length&&e.visible[0].length<=20?e.visible.push(t):e.hidden.push(t),e),{visible:[],hidden:[]});return(0,n.jsx)(a.E,{as:"span",className:e,weight:500,children:(0,n.jsxs)(i.B,{align:"center",direction:"row",gap:2,style:{display:"flex",maxWidth:"100%",alignItems:"stretch",...r},children:[u.map((e,l)=>{let i=l===u.length-1;return(0,n.jsx)(c.A,{defaultRoute:t,icon:o,style:{marginRight:i?void 0:"var(--geist-gap-half)",minWidth:0},truncate:!0,url:e,...d},e)}),h.length?(0,n.jsx)(p,{hidden:h,linkProps:d}):null]})})}},255588:(e,t,l)=>{"use strict";l.d(t,{Scroller:()=>g});var n=l(467926),i=l(535478),a=l(469916),s=l(921693),o=l(408557),r=l.n(o),d=l(298949),c=l(338288),u=l(32184),h=l(683885),p=l(894552),m=l(9573),x=l.n(m);function g({width:e="100%",height:t="100%",overflow:l="both",children:o,className:m,scrollerClassName:g,overlayClassName:b,childrenContainerClassName:y,buttonContainerClassName:j,gradient:f,withButtons:v,setContainerRef:k}){let w=(0,i.useRef)(null),[C,{width:A,height:_}]=(0,s.A)(),[S,$]=(0,i.useState)(0),{isHorizontal:L,isVertical:E}=(0,i.useMemo)(()=>({isHorizontal:"y"!==l,isVertical:"x"!==l}),[l]),[D,N]=(0,i.useState)({top:!1,right:!1,bottom:!1,left:!1});(0,i.useEffect)(()=>{k&&w.current&&k(w.current)},[k]);let T=(0,i.useMemo)(()=>r()(()=>{if(!w.current)return;let e=w.current,t=e.scrollTop,l=e.scrollLeft,n=E&&t>5,i=E&&t+e.clientHeight+5<e.scrollHeight,a=L&&l>5,s=L&&l+e.clientWidth+5<e.scrollWidth;N(e=>n===e.top&&i===e.bottom&&a===e.left&&s===e.right?e:{top:n,right:s,bottom:i,left:a});let o=w.current,r=0;for(let e of o.children.item(0)?.children??[])if(L?e.offsetLeft<o.scrollLeft:e.offsetTop<o.scrollTop)r++;else break;$(r)},100),[L,E,$]);(0,i.useEffect)(()=>{T()},[A,_]);let B=(0,i.useCallback)(e=>{let t=w.current;if(!t)return;let l=t.children.item(0)?.children.item(e),n=l?.getBoundingClientRect()??{top:0,left:0},i=l?.parentElement?.getBoundingClientRect()??{top:0,left:0},a={behavior:"smooth"};E&&(a.top=n.top-i.top),L&&(a.left=n.left-i.left),t.scrollTo(a)},[L,E]),P=(0,i.useCallback)(()=>{if(S<i.Children.count(o)-1){let e=S+1;B(e),$(e)}},[B,S,o]),R=(0,i.useCallback)(()=>{if(S>0){let e=S-1;B(e),$(e)}},[B,S]),z=(0,i.useMemo)(()=>!v||L&&E?null:(0,n.jsxs)("div",{className:(0,a.$)(x().buttons,j),children:[(0,n.jsx)(p.Button,{"aria-label":`scroll ${L?"left":"top"}`,onClick:R,shape:"circle",size:"small",svgOnly:!0,type:"secondary",children:L?(0,n.jsx)(u.J,{}):(0,n.jsx)(c.r,{})}),(0,n.jsx)(p.Button,{"aria-label":`scroll ${L?"right":"bottom"}`,onClick:P,shape:"circle",size:"small",svgOnly:!0,type:"secondary",children:L?(0,n.jsx)(h.c,{}):(0,n.jsx)(d.y,{})})]}),[v,j,L,E,R,P]);return(0,n.jsxs)(n.Fragment,{children:[E?z:null,(0,n.jsxs)("div",{className:(0,a.$)(x().overlayContainer,m,{[x().isHorizontal]:L}),"data-geist-scroller":"","data-version":"v1",style:{width:e,height:t},children:[(0,n.jsx)("div",{className:(0,a.$)(x().overlay,Object.entries(D).map(([e,t])=>t?x()[e]:null),b),"data-geist-scroller-overlay":"",style:f?{"--scroller-gradient":f}:void 0}),(0,n.jsx)("div",{className:(0,a.$)(x().scroller,g),"data-geist-scroller-container":"","data-geist-scroller-overflowing":Object.values(D).some(Boolean)?"":void 0,onScroll:T,ref:w,children:(0,n.jsx)("div",{className:y,ref:C,children:o})})]}),L?z:null]})}},292937:(e,t,l)=>{"use strict";l.d(t,{Q:()=>ex});var n=l(467926),i=l(535478),a=l(404019),s=l(260444),o=l(172707),r=l(20652),d=l(352170),c=l(905067),u=l(905393),h=l(916354),p=l(841095),m=l(778950),x=l(894552),g=l(343949),b=l(409794),y=l(493624),j=l(39636),f=l(919922),v=l(861146),k=l(428355),w=l(377502),C=l(528443),A=l(360968),_=l(101920),S=l(744005),$=l(42227),L=l(658855),E=l(626156),D=l(917792),N=l(380434),T=l(555219),B=l(383822),P=l.n(B);function R({className:e,label:t,labelPadding:l=7,labelSize:i=14,size:a=22,status:s}){let o=(0,T.px)(a);return(0,n.jsxs)("div",{className:`${P().wrapper} ${e||""}`,style:{height:o},children:["loading"===s&&(0,n.jsx)(N.y,{size:a}),"error"===s&&(0,n.jsx)(E.$,{color:"red-700",size:a}),"success"===s&&(0,n.jsx)(D.r,{color:"green-700",size:a}),t?(0,n.jsx)(m.E,{as:"span",size:i,style:{lineHeight:o,paddingLeft:(0,T.px)(l)},children:t}):null]})}var z=l(55034),I=l(470762),F=l(215790),M=l(122680),O=l(426748),H=l.n(O),W=l(389090),U=l.n(W),V=l(136252);let J="[teamSlug]";var q=l(977227),Z=l(399825),Y=l(995800),G=l(720559),X=l(69135),Q=l(61139),K=l(444165),ee=l(221555),et=l(170360),el=l(249863),en=l(218702),ei=l.n(en);function ea(e){return(0,n.jsx)(g.a.Header,{children:(0,n.jsx)(g.a.Title,{center:!0,children:"Instant Rollback"})})}function es({setStage:e,wouldBeUndoRollback:t}){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(g.a.Body,{children:[(0,n.jsx)(ea,{wouldBeUndoRollback:t}),(0,n.jsx)(m.E,{as:"p",style:{marginBottom:"24px"},children:"Error: You must select a deployment to roll back."})]}),(0,n.jsx)(g.a.Actions,{children:(0,n.jsx)(g.a.Action,{fullWidth:!0,onClick:()=>{e("initial")},type:"secondary",children:"Back"})})]})}function eo(){return(0,n.jsx)("div",{children:(0,n.jsx)(y.Note,{className:H()["warning-note"],fill:!0,label:!1,type:"warning",variant:"contrast",children:(0,n.jsxs)(p.B,{align:"center",direction:"row",gap:4,style:{padding:4},children:[(0,n.jsx)(u.N,{style:{flexShrink:0}}),(0,n.jsxs)(p.B,{align:"start",children:[(0,n.jsx)(m.E,{as:"p",color:"inherit",children:"Make sure the domains listed above are correct."}),(0,n.jsx)(m.E,{as:"p",color:"inherit",children:"This deployment has custom aliases not included in the project's domain settings."})]})]})})})}function er({deployments:e,previousDeployment:t,productionDeployment:l,selectedDeployment:i,setSelectedDeployment:a,swr:s}){return(0,n.jsxs)(n.Fragment,{children:[e.map(e=>l.id!==e.uid&&(0,n.jsx)(et.F,{deployment:e,isForm:!0,isPreviousDeployment:t.uid===e.uid,selectedDeployment:i,setSelectedDeployment:a},e.uid)),!s.isReachingEnd&&(0,n.jsx)(x.Button,{className:ei()["choose-deployment-btn"],loading:s.isLoadingMore,onClick:()=>{s.loadMore()},style:{marginTop:24},type:"secondary",width:"100%",children:"Show More"})]})}function ed({hasFloatingAliases:e,onCancel:t,previousDeployment:l,productionAliases:s,productionDeployment:o,rollbackCandidates:c,setStage:u,selectedDeployment:b,setSelectedDeployment:j,deploymentSwr:f,wouldBeUndoRollback:v}){let C=function(e){let t=(0,V.S)();return(0,i.useMemo)(()=>e.includes(J)?e.replace(`/${J}`,t?`/${t}`:""):e,[t,e])}("/[teamSlug]"),[A,_]=(0,i.useState)(!1),{team:S}=(0,a.dA)(),$=!S||S.billing?.plan==="hobby",{value:L}=(0,r.Jo)(),{value:E}=(0,d.Gk)(),{value:D}=(0,r.aM)();return c.length&&l&&b?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(g.a.Body,{children:[(0,n.jsx)(ea,{wouldBeUndoRollback:v}),(0,n.jsxs)(p.B,{gap:6,children:[(0,n.jsxs)(p.B,{gap:4,children:[(0,n.jsxs)(m.E,{as:"p",children:[v?"Undo previous rollback for":"Rolling back"," ",(0,n.jsx)(el.A,{domains:s,firstOnly:!0,style:{display:"inline-flex",fontWeight:"500"}})]}),e?(0,n.jsx)(eo,{}):null,(0,n.jsx)("div",{children:(0,n.jsx)(et.F,{deployment:o,isProductionDeployment:!0,selectedDeployment:b,setSelectedDeployment:j})})]}),(0,n.jsxs)(p.B,{gap:4,children:[(0,n.jsx)(m.E,{as:"p",children:"To the following deployment:"}),A?(0,n.jsx)("div",{children:(0,n.jsx)(er,{deployments:c,previousDeployment:l,productionDeployment:o,selectedDeployment:b,setSelectedDeployment:j,swr:f})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(et.F,{deployment:b,isForm:A,isPreviousDeployment:b.uid===l.uid,selectedDeployment:b,setSelectedDeployment:j}),(L||E)&&$?(0,n.jsx)(p.B,{style:{marginTop:"24px"},children:(0,n.jsx)(y.Note,{className:U()["info-note"],fill:!0,label:!1,size:"small",variant:"contrast",children:(0,n.jsxs)(p.B,{align:"center",direction:"row",gap:4,style:{padding:8},children:[(0,n.jsx)(k.C,{style:{transform:"translateX(1px)"}}),(0,n.jsxs)(p.B,{align:"start",direction:"column",children:[(0,n.jsx)(m.E,{as:"p",color:"inherit",weight:500,children:"Looking for an earlier deployment?"}),(0,n.jsxs)("div",{children:[(0,n.jsx)(I.N,{className:U()["info-note-link"],href:"/"===C?"/dashboard?createTeam=instant-rollback":`${C}?upgradeTeam=instant-rollback`,target:"_blank",children:(0,n.jsx)(m.E,{as:"span",color:"inherit",children:"Upgrade to Pro"})}),(0,n.jsx)(h.F,{className:"ml-1"}),(0,n.jsx)(m.E,{as:"span",color:"inherit",style:{whiteSpace:"nowrap"},children:"to roll back to an earlier deployment"})]})]})]})})}):(0,n.jsx)(x.Button,{onClick:()=>{_(!0)},type:"secondary",width:"100%",children:"Choose another deployment"})]})]}),D?(0,n.jsx)(m.E,{color:"gray-900",children:"Instant Rollback assigns domains to a previous deployment. All Environment Variables from the original build will remain. Cron jobs will be reverted to the state of the previous deployment."}):null]})]}),(0,n.jsxs)(g.a.Actions,{children:[(0,n.jsx)(g.a.Action,{onClick:t,type:"secondary",children:"Cancel"}),(0,n.jsx)(g.a.Action,{"data-testid":(0,w.g)("deployment","rollback-modal","continue-button"),onClick:()=>{u("selected")},children:"Continue"})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(g.a.Body,{children:[(0,n.jsx)(ea,{wouldBeUndoRollback:v}),(0,n.jsx)(m.E,{as:"p",children:"This project does not have any valid deployments to roll back to."})]}),(0,n.jsx)(g.a.Actions,{children:(0,n.jsx)(g.a.Action,{onClick:t,type:"secondary",children:"Cancel"})})]})}function ec({selectedDeployment:e,setStage:t,requestRollback:l,project:a,wouldBeUndoRollback:s,rollbackReason:o,setRollbackReason:d,rollbackDescription:c,setSelectedDeployment:u,productionAliases:x,hasFloatingAliases:b,productionDeployment:k,rollbackCandidates:C}){let{value:A}=(0,r.aM)(),[_,$]=(0,i.useState)(!1),[L,E]=(0,i.useState)(!1),[D,N]=(0,i.useState)("editing"),{user:T}=(0,S.Jd)();return e?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(g.a.Body,{children:[(0,n.jsx)(ea,{wouldBeUndoRollback:s}),A?(0,n.jsxs)(p.B,{gap:6,children:["editing"===D&&(0,n.jsxs)(n.Fragment,{children:[s?null:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(p.B,{gap:4,children:[(0,n.jsxs)(p.B,{as:"label",gap:1,htmlFor:"rollback-reason",children:[(0,n.jsx)(m.E,{as:"span",size:16,children:"What is the reason for the rollback?"}),(0,n.jsx)(m.E,{as:"span",color:"gray-900",size:16,children:"This will let other members of your team know why this project is in a rolled back state"})]}),(0,n.jsx)(j.T,{autoFocus:!0,className:"min-h-24 min-h-[5lh] text-base",error:o.length>=256?`Reason cannot be longer then 256 characters. Currently ${o.length}.`:void 0,id:"rollback-reason",onChange:e=>{d(e.target.value)},placeholder:"Production is not behaving as expected...",required:!0,value:o})]}),(0,n.jsx)(f.S,{checked:L,onChange:e=>{E(e.target.checked)},children:(0,n.jsxs)(m.E,{as:"span",className:"mt-[-2px] inline-block",size:16,children:["I have visited the"," ",(0,n.jsx)(I.N,{external:!0,href:`https://${e.url}`,target:"_blank",type:"highlight",children:"rollback deployment"})," ","and verified that it is not affected by this issue."]})})]}),s&&c?(0,n.jsx)(Y.Ou,{checked:_,deployment:e,onChange:$,project:a,rollbackDescription:c}):null]}),"confirming"===D&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(p.B,{gap:4,children:[(0,n.jsx)(m.E,{size:16,children:"Note to be shared with your team:"}),(0,n.jsxs)("div",{className:"bg-background-200 shadow-border rounded px-4 py-3",children:[(0,n.jsxs)(m.E,{color:"gray-900",children:["“",(0,n.jsx)(ee.O,{text:o.trim()}),"”"]}),(0,n.jsxs)("div",{className:"flex gap-1 pt-1",children:[(0,n.jsx)(m.E,{children:"Rolled back by"}),T?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(v.Avatar,{size:20,username:T.username}),(0,n.jsxs)(m.E,{weight:500,children:["@",T.username]})]}):null]})]})]}),(0,n.jsxs)(p.B,{gap:4,children:[(0,n.jsx)(m.E,{size:16,children:"Rolling back to:"}),(0,n.jsx)(et.F,{deployment:e,isPreviousDeployment:e.uid===C[0].uid,selectedDeployment:e,setSelectedDeployment:()=>null})]}),(a?.autoAssignCustomDomains??!0)||a?.lastAliasRequest?.type==="rollback"?(0,n.jsx)(y.Note,{fill:!0,type:"secondary",children:(0,n.jsx)(p.B,{align:"center",direction:"row",gap:4,children:(0,n.jsx)(p.B,{align:"start",children:(0,n.jsx)(m.E,{as:"p",color:"inherit",children:"After rolling back, production deployments will not be automatically promoted until the rollback is removed."})})})}):null]})]}):(0,n.jsx)(p.B,{gap:6,children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(m.E,{as:"p",children:[s?"Undo previous rollback for":"Roll back"," ",(0,n.jsx)(el.A,{domains:x,style:{display:"inline-flex",fontWeight:"600"}})]}),b?(0,n.jsx)(eo,{}):null,(0,n.jsx)(et.F,{deployment:k,isProductionDeployment:!0,selectedDeployment:e,setSelectedDeployment:u}),(0,n.jsx)(m.E,{as:"p",children:"To the following deployment:"}),(0,n.jsx)(et.F,{deployment:e,isPreviousDeployment:e.uid===C[0].uid,selectedDeployment:e,setSelectedDeployment:u}),(0,n.jsxs)(z.UL,{className:ei()["warning-list"],children:[(0,n.jsx)(z.LI,{children:"Instant Rollback assigns domains to a previous deployment. All Environment Variables from the original build will remain. Cron jobs will be reverted to the state of the previous deployment."}),(0,n.jsxs)(z.LI,{children:[(0,n.jsxs)(I.N,{className:ei()["deployment-link"],href:`https://${e.url}`,target:"_blank",children:["View the selected deployment"," ",(0,n.jsx)(h.F,{className:"ml-1"})]})," ","before rolling back—external APIs, databases, and CMS platforms may not behave as expected."]})]})]})})]}),(0,n.jsxs)(g.a.Actions,{children:[(0,n.jsx)(g.a.Action,{onClick:()=>{"editing"===D?t("initial"):N("editing")},type:"secondary",children:"Back"}),(0,n.jsx)(g.a.Action,{"data-testid":(0,w.g)("deployment","rollback-modal","rollback-button"),disabled:!!(A&&(s?c&&!_:""===o||!L||o.length>=256)),onClick:()=>{A&&"editing"===D?N("confirming"):(l(e.uid),t("processing"))},children:s?"Undo Rollback":"editing"===D?"Continue":"Confirm Rollback"})]})]}):(0,n.jsx)(es,{setStage:t,wouldBeUndoRollback:s})}function eu({jobStatus:e,rollbackDeploymentId:t,rollbackCandidates:l,selectedDeployment:a,setStage:s,onCancel:o,statusSwr:d,requestRollback:c,wouldBeUndoRollback:u,rollbackReason:h}){let{user:b}=(0,S.Jd)(),{value:y}=(0,r.aM)();return((0,i.useEffect)(()=>{t===a?.uid&&("failed"===e?s("error"):"succeeded"===e&&s("done"))},[t,e,a,s]),a)?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(g.a.Body,{children:[(0,n.jsx)(ea,{wouldBeUndoRollback:u}),(0,n.jsxs)(p.B,{gap:6,children:[(0,n.jsxs)(p.B,{gap:4,children:[(0,n.jsx)(m.E,{children:"Assigning production domains:"}),(0,n.jsx)(et.F,{deployment:a,isPreviousDeployment:a.uid===l[0].uid,selectedDeployment:a,setSelectedDeployment:()=>null})]}),y&&""!==h?(0,n.jsxs)("div",{className:"bg-background-200 shadow-border rounded px-4 py-3",children:[(0,n.jsxs)(m.E,{color:"gray-900",children:["“",(0,n.jsx)(ee.O,{text:h.trim()}),"”"]}),(0,n.jsxs)("div",{className:"flex gap-1 pt-1",children:[(0,n.jsx)(m.E,{children:"Rolled back by"}),b?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(v.Avatar,{size:20,username:b.username}),(0,n.jsxs)(m.E,{weight:500,children:["@",b.username]})]}):null]})]}):null,(0,n.jsxs)(z.UL,{className:ei()["alias-list"],children:[d.aliases.map(e=>{let t="loading";return"completed"===e.status?t="success":"failed"===e.status&&(t="error"),(0,n.jsx)(z.LI,{children:(0,n.jsx)(R,{label:e.alias,labelPadding:"12px",size:24,status:t})},e.alias)}),!d.isReachingEnd&&d.initialDataLoaded?(0,n.jsx)(z.LI,{children:(0,n.jsx)(x.Button,{className:ei()["choose-deployment-btn"],loading:d.isLoadingMore,onClick:()=>{d.loadMore()},style:{marginTop:24},type:"secondary",width:"100%",children:"Show More"})}):null]})]})]}),(0,n.jsx)(g.a.Actions,{children:(0,n.jsx)(g.a.Action,{"data-testid":(0,w.g)("deployment","rollback-modal","finish-button"),fullWidth:!0,loading:"failed"!==e&&"succeeded"!==e,onClick:()=>{"failed"===e?c(a.uid):"succeeded"===e&&(s("initial"),o())},children:"failed"===e?"Retry":"Done"})})]}):(0,n.jsx)(es,{setStage:s,wouldBeUndoRollback:u})}function eh({active:e,initialSelectedDeployment:t,onCancel:l,productionBranch:s,productionDeployment:o,projectId:d,rollbackCandidates:c,swr:u,wouldBeUndoRollback:h,rollbackDescription:p}){let{mutate:m}=(0,$.iX)(),[x,y]=(0,i.useState)("initial"),[j,f]=(0,i.useState)(""),{isReady:v,team:k}=(0,a.dA)(),S=(0,b.useToasts)(),E=(0,i.useMemo)(()=>{if(c.length)return c[0].uid!==o.id?c[0]:c[1]},[c,o]),[D,N]=(0,i.useState)(null);(0,i.useEffect)(()=>{N(t||E||null)},[t,E]);let T=(0,i.useCallback)(y,[y]),B=(0,i.useCallback)(N,[N]),{value:P}=(0,r.aM)(),[,{aliases:R}]=(0,M.wD)({rollbackDeploymentId:o.id}),{data:z}=(0,q.By)(d,Q.z),{lastAliasRequest:I,hasFloatingAliases:O}=z||{lastAliasRequest:void 0,hasFloatingAliases:!1},{toDeploymentId:H,jobStatus:W}=I||{toDeploymentId:null,jobStatus:null},[,U]=function(e,t=0,l=20){let{isReady:n,team:s}=(0,a.dA)(),o=(0,F.Ay)((t,i)=>{if(!n)return null;let a={teamId:s?.id,limit:l};return t?i?.next?`${(0,_.Xc$)(e)}${(0,C.l)({...a,until:i.next})}`:null:`${(0,_.Xc$)(e)}${(0,C.l)(a)}`},e=>(0,A.ff)(e,{throwOnHTTPError:!0}),{refreshInterval:t}),r=(0,i.useMemo)(()=>o.data?[].concat(...o.data.filter(Boolean).map(e=>e.aliases.slice(0,l))):[],[o.data,l]),d=!!o.data,c=d&&0===r.length,u=d&&o.data&&o.size>o.data.length,h=d&&o.data&&o.data[o.data.length-1]?.aliases.length<l;return[o,{aliases:r,initialDataLoaded:d,isEmpty:c,loadMore:()=>o.setSize(e=>e+1),isLoadingMore:u,isReachingEnd:h,mutate:o.mutate}]}(d,2e3),V=(0,i.useMemo)(()=>o,[e]),J=()=>{y("initial"),N(t||E||null),l()},Y=(0,i.useCallback)(async e=>{if(!v)return;let t=`${(0,_.maM)(d,e)}${(0,C.l)({teamId:k?.id,description:P?j.trim():void 0})}`;try{await (0,A.ff)(t,{throwOnHTTPError:!0,method:"POST",body:{}}),k&&(void 0!==z&&(m((0,G.n)(z.name,{...Q.z,teamId:k.slug})),m((0,G.n)(z.name,{...K.P,teamId:k.slug}))),await m((0,X.h)({projectIdOrName:d,teamId:k.slug})))}catch(e){S.error({text:"Something went wrong - please try requesting an Instant Rollback again",key:"rollback-deployment"}),(0,L.l)(e)}},[v,d,S,j,m,k,P,z]),ee=(0,Z.m)(s),et={rollbackDeploymentId:H,hasFloatingAliases:!!O,jobStatus:W,onCancel:J,previousDeployment:E,productionBranch:s,productionDeployment:V,productionAliases:R.map(({alias:e})=>e),project:z,rollbackCandidates:c,setStage:T,selectedDeployment:D,setSelectedDeployment:B,deploymentSwr:u,statusSwr:U,requestRollback:Y,rollbackWarningText:ee,wouldBeUndoRollback:h,rollbackReason:j,setRollbackReason:f,rollbackDescription:p};return(0,n.jsxs)(g.a.Modal,{active:e,"data-testid":(0,w.g)("deployment","rollback-modal"),onClickOutside:J,sticky:!0,width:"500px",children:["initial"===x&&(0,n.jsx)(ed,{...et}),"selected"===x&&(0,n.jsx)(ec,{...et}),["processing","error","done"].includes(x)&&(0,n.jsx)(eu,{...et})]})}var ep=l(226079),em=l(318346);function ex(e,{onClose:t}={}){let[l,u]=(0,i.useState)(!1),[h,p]=(0,i.useState)(),{team:m}=(0,a.dA)(),x=!m||m.billing?.plan==="hobby",{value:g}=(0,r.Jo)(),{value:b}=(0,d.Gk)(),{readyValue:y}=(0,r.Z_)(),j=(0,Y.UC)({projectId:e?.id||"",deployment:h}),f=g||b,{deployment:v,rollbackDescription:k,mutate:w,isLoading:C}=(0,c.J)(e?.name),{can:A}=(0,s.Ay)({projectIdOrName:e?.name}),_=A(o.r.Create,o.F.DeploymentRollback),S=e?.link?.productionBranch?e.link.productionBranch:void 0,[$,L]=(0,ep.I)({projectId:e?e.id:"",requireProject:!0,limit:10,rollbackCandidate:!0},{}),{deployments:E,initialDataLoaded:D}=L,N=E.filter(e=>e.isRollbackCandidate),T=!!(D&&e&&!N.length),B=(0,i.useCallback)(e=>{p((0,em._)(e)),u(!0)},[]),P=(0,i.useCallback)(()=>{u(!1),w().finally(()=>null),t?.()},[w,t]),R=(0,i.useCallback)(e=>{let t=(0,em._)(e),l=x&&!t?.isRollbackCandidate;return t?C?"Loading...":y&&"readyState"in t&&"READY"!==t.readyState?"Only Deployments that are Ready can be rolled back.":y&&"readySubstate"in t&&"PROMOTED"!==t.readySubstate?"Only Deployments previously aliased to a Production domain can be rolled back.":t.uid===v?.id?"This Deployment is already in Production.":T?"There are no previous deployments to roll back to.":f?t.isRollbackCandidate||"production"===t.target?l?"Hobby customers can only roll back to the previous deployment.":"":"Only Deployments previously aliased to a Production domain can be rolled back.":t.isRollbackCandidate?"":"Only Deployments previously aliased to a Production domain can be rolled back.":""},[x,y,T,C,v?.id,f]);return{rollbackModal:(0,i.useMemo)(()=>_&&l&&v&&e?(0,n.jsx)(eh,{active:l,initialSelectedDeployment:h,onCancel:P,productionBranch:S,productionDeployment:v,projectId:e.id,rollbackCandidates:N,rollbackDescription:k,swr:L,wouldBeUndoRollback:j}):null,[_,l,h,S,v,N,e,L,P,j,k]),closeRollbackModal:P,openRollbackModal:B,getRollbackTooltip:R,canRollbackDeployment:_,noRollbackCandidates:T}}},309486:(e,t,l)=>{"use strict";l.d(t,{A:()=>m});var n=l(467926),i=l(535478),a=l(720241),s=l(818289),o=l(696692),r=l(192864),d=l(858826),c=l(266565),u=l(641571),h=l(937564),p=l.n(h);let m=(0,i.memo)(function({url:e,truncate:t,defaultRoute:l,...h}){let[m,x]=(0,o.A)("#wildcard"),[g,b]=(0,i.useState)(null),[y,j]=(0,i.useState)(!1),f=(0,i.useCallback)(()=>{b((0,r.A)(e)),x(!0)},[b,x,e]);return e?(0,d.A)(e)?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.Link,{className:p().aliasLink,onClick:f,...h,onMouseEnter:()=>j(!0),style:{minWidth:0,maxWidth:t?"100%":void 0},children:t?(0,n.jsx)("span",{className:"geist-ellipsis",children:e}):e}),y||m?(0,n.jsx)(s.A,{active:m,onCancel:()=>{x(!1)},url:g}):null]}):(0,n.jsx)(a.Link,{className:p().aliasLink,external:!0,href:(0,u.d)((0,c.t)(e),l),...h,style:{minWidth:0,maxWidth:t?"100%":void 0},children:t?(0,n.jsx)("span",{className:"geist-ellipsis",children:e}):e}):null})},318346:(e,t,l)=>{"use strict";function n(e){if(!e)return;if("id"in e==!1)return e;let{aliasAssigned:t,aliasError:l=null,aliasAssignedAt:n,buildingAt:i,created:a=e.createdAt,createdAt:s,creator:o,name:r,ready:d,state:c="BUILDING",readyState:u,readySubstate:h,target:p=null,uid:m=e.id,url:x,isRollbackCandidate:g="production"===e.target}=e;return{aliasAssigned:t,aliasError:l,aliasAssignedAt:n,buildingAt:i,created:a,createdAt:s,creator:{email:"",githubLogin:"",...o},name:r,ready:d,state:c,readyState:u,readySubstate:h,target:p,type:"LAMBDAS",uid:m,url:x,isRollbackCandidate:g}}l.d(t,{_:()=>n})},339382:(e,t,l)=>{"use strict";l.d(t,{A:()=>i});var n=l(467926);let i=function({margin:e=50,className:t}){return(0,n.jsx)("hr",{className:t,style:{border:"0",borderTop:"1px solid var(--accents-2)",margin:"number"==typeof e?`${e}px 0`:`${e} 0`}})}},383822:e=>{e.exports={wrapper:"loading-checkmark_wrapper__OKiho"}},389090:e=>{e.exports={"info-note":"info-note_info-note__y38il","info-note-link":"info-note_info-note-link__Br8oR"}},399825:(e,t,l)=>{"use strict";l.d(t,{m:()=>s});var n=l(20652),i=l(467926),a=l(778950);function s(e){let{readyValue:t}=(0,n.Z_)(),{value:l}=(0,n.aM)();return t?l?"New deployments will not be automatically assigned production domains until this rollback is removed.":"Pushing a new deployment will remove this rollback.":e?(0,i.jsxs)(i.Fragment,{children:["This rollback will be replaced by the next merge to"," ",(0,i.jsx)(a.E,{as:"span",color:"inherit",monospace:!0,children:e}),"."]}):"This rollback will be replaced by the next production deployment."}},426748:e=>{e.exports={"warning-note":"warning-note_warning-note__T6NL4","warning-note-link":"warning-note_warning-note-link__RYfns"}},444165:(e,t,l)=>{"use strict";l.d(t,{P:()=>n});let n={apiVersion:"v9",latestDeployments:10,fetchParams:{rollbackInfo:!0,floatingAliases:!1}}},486906:(e,t,l)=>{"use strict";l.d(t,{X:()=>o});var n=l(467926),i=l(555219),a=l(847355),s=l.n(a);function o({size:e=2,height:t,children:l}){return(0,n.jsxs)("span",{className:s().loading,"data-geist-loading-dots":"","data-version":"v1",style:{"--loading-dots-height":t?(0,i.px)(t):void 0,"--loading-dots-size":2!==e?(0,i.px)(e):void 0},children:[l?(0,n.jsx)("div",{className:s().spacer,children:l}):null,(0,n.jsx)("span",{}),(0,n.jsx)("span",{}),(0,n.jsx)("span",{})]})}},529756:(e,t,l)=>{"use strict";l.d(t,{Ub:()=>a,Ww:()=>o,al:()=>s});var n=l(535478);let i=!1,a=(e,t)=>{let l=[`(max-width: ${e}px)${null!=t?",":""}`,null!=t?`(max-height: ${t}px)`:null].filter(Boolean).join(" "),[a,s]=(0,n.useState)(()=>i?window.innerWidth<=e||void 0!==t&&window.innerHeight<=t:void 0),o=(0,n.useRef)(a);return(0,n.useEffect)(()=>{o.current=a},[a]),(0,n.useEffect)(()=>{let n=()=>{s(a.matches)};void 0===o.current&&s(window.innerWidth<=e||void 0!==t&&window.innerHeight<=t),i=!0;let a=window.matchMedia(l);return a.addEventListener("change",n),a.matches&&s(!0),()=>{a.removeEventListener("change",n)}},[e,t,l]),a},s=(e=600)=>a(e),o=()=>a(960)},554118:(e,t,l)=>{"use strict";l.d(t,{S:()=>r});var n=l(467926),i=l(469916);l(535478);var a=l(894552),s=l(765824),o=l.n(s);let r=({normal:e,active:t,hover:l,className:s,...r})=>(0,n.jsx)(a.Button,{...r,className:(0,i.$)(o().button,s),"data-custom-button":"",style:{"--button-custom-fg":`${e?.foreground||""}`,"--button-custom-bg":`${e?.background||""}`,"--button-custom-border":`${e?.border||""}`,"--button-custom-fg-active":`${t?.foreground||""}`,"--button-custom-bg-active":`${t?.background||""}`,"--button-custom-border-active":`${t?.border||""}`,"--button-custom-fg-hover":`${l?.foreground||""}`,"--button-custom-bg-hover":`${l?.background||""}`,"--button-custom-border-hover":`${l?.border||""}`},children:r.children})},567815:(e,t,l)=>{"use strict";l.d(t,{A:()=>h});var n=l(467926),i=l(535478),a=l(42227),s=l(343949),o=l(409794),r=l(360968),d=l(101920),c=l(983560),u=l(496145);let h=i.memo(({active:e,onClose:t,deployment:l,teamId:h})=>{let[p,m]=(0,i.useState)(!1),x=(0,o.useToasts)(),g=(0,i.useCallback)(async()=>{if(!l)return;m(!0);let e=h?"?teamId="+h:"",n=await (0,r.ff)(`${(0,d.SyP)("v12")}/${l.id}/cancel`+e,{throwOnHTTPError:!1,method:"PATCH"});n.error&&x.error(`Could not cancel the deployment, it's ${l.readyState}`),"CANCELED"===n.readyState&&(x.success("The deployment has been successfully canceled."),(0,a.Tk)((0,u.ID)(l.id),{...l,readyState:n.readyState,status:n.readyState,canceledAt:n.canceledAt,host:l.url,isPrivate:!l.public})),m(!1),t()},[l,h,x,t]);return(0,n.jsxs)(s.a.Modal,{active:e,onClickOutside:t,width:"500px",children:[(0,n.jsxs)(s.a.Body,{children:[(0,n.jsx)(s.a.Header,{children:(0,n.jsx)(s.a.Title,{children:"Cancel Deployment"})}),(0,n.jsx)(c.A,{children:"Canceling this deployment will immediately stop the build, with no way to resume."}),(0,n.jsx)(c.A,{style:{margin:0},children:"Are you sure you want to continue?"})]}),(0,n.jsxs)(s.a.Actions,{children:[(0,n.jsx)(s.a.Action,{loading:!1,onClick:t,type:"secondary",children:"Close"}),(0,n.jsx)(s.a.Action,{disabled:p,loading:p,onClick:g,children:"Cancel deployment"})]})]})})},584520:(e,t,l)=>{"use strict";l.d(t,{A:()=>q,N:()=>Z});var n=l(467926),i=l(535478),a=l(710822),s=l(228450),o=l(720241),r=l(919922),d=l(949646),c=l(486906),u=l(343949),h=l(493624),p=l(582892),m=l(841095),x=l(778950),g=l(409794),b=l(477838),y=l(377502),j=l(528443),f=l(360968),v=l(101920),k=l(744005),w=l(404019),C=l(42227),A=l(20652),_=l(625249),S=l(936895),$=l(656929),L=l(289062),E=l(983560),D=l(905067),N=l(74743),T=l(839239),B=l(318346),P=l(339382),R=l(431164),z=l(426748),I=l.n(z),F=l(995800),M=l(720559),O=l(61139),H=l(444165),W=l(69135),U=l(170360),V=l(435227);function J({title:e}){return(0,n.jsx)(u.a.Header,{children:(0,n.jsx)(u.a.Title,{center:!0,children:e})})}function q(e,t){let[l,a]=(0,i.useState)(!1),[s,g]=(0,i.useState)(null),j=(0,R.z)({project:t,deployment:s}),[f,v]=(0,i.useState)(V.eb),{value:C}=(0,A.aM)(),N=(0,i.useCallback)(()=>{a(!1)},[]),{error:z,loading:M,promote:O,setError:H,setLoading:W}=Z({deployment:s,setUseIgnoreBuildStep:v,useIgnoreBuildStep:f,project:t}),{user:q}=(0,k.Jd)(),{team:Y}=(0,w.dA)(),{data:G}=(0,T.U0)(e,{limit:11,production:"true",redirects:"false",verified:"true",order:"ASC"}),{readyValue:X}=(0,A.Z_)(),Q=(0,i.useCallback)(e=>{g(e),a(!0),X||v(V.eb)},[X]),K=(0,i.useCallback)(()=>{W(!1),g(null),H(void 0)},[H,W]),{deployment:ee,isLoading:et,rollbackDescription:el,deploymentIsStale:en}=(0,D.J)(t?.name),[ei,ea]=(0,i.useState)(!1),es=(0,i.useCallback)((e,t)=>{let l=(0,B._)(e);return X&&!l?"":X&&et?"Loading...":X&&l?.uid===ee?.id?"This Deployment is already in Production.":X&&l&&"readyState"in l&&"READY"!==l.readyState?"Only Deployments that are Ready can be promoted.":X&&l&&"production"===l.target&&"readySubstate"in l&&"STAGED"!==l.readySubstate?'Only preview and staged production deployments can be promoted. If you want to make this deployment "Current", use Instant Rollback.':t?"Deployment is already the current deployment":""},[et,ee?.id,X]),{andMoreDomains:eo,remainingDomains:er}=(0,i.useMemo)(()=>{if(!G)return{andMoreDomains:!1,remainingDomains:[]};let e=G.length>2,t=e?G.slice(2).map(e=>e.name):[];return{andMoreDomains:e,remainingDomains:t}},[G]),ed=(0,i.useMemo)(()=>t&&s?X?(0,n.jsxs)(n.Fragment,{children:["production"===s.target?(0,n.jsx)(x.E,{as:"p",style:{marginBottom:"16px"},weight:400,children:"Deployment to promote:"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(x.E,{as:"p",style:{marginBottom:"16px"},children:"A new deployment will be built using your production environment."}),(0,n.jsx)(x.E,{as:"p",style:{marginBottom:"16px"},weight:400,children:"Deployment to promote to production:"})]}),(0,n.jsx)("div",{children:(0,n.jsx)(U.F,{deployment:s,isPromote:!0,selectedDeployment:null})}),G&&G.length>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(x.E,{as:"p",style:{marginBottom:16,marginTop:24},weight:400,children:"It will be aliased to the following domains:"}),(0,n.jsx)(m.B,{gap:2,style:{paddingLeft:12},children:G.slice(0,2).map(({name:e})=>(0,n.jsx)(x.E,{as:"p",children:(0,n.jsxs)(m.B,{align:"center",direction:"row",gap:3,children:[(0,n.jsx)(b.a,{color:"blue-700",size:20}),(0,n.jsx)("span",{children:e.startsWith("*")?e:(0,n.jsx)(o.Link,{"data-testid":(0,y.g)("deployments","promote-to-production-overlay","preview-link"),external:!0,href:`https://${e}`,variant:"highlight",children:e})})]})},e))}),eo?(0,n.jsxs)(x.E,{as:"p",className:"mt-6 mb-4",children:["...and ",er.length," more"]}):null]}):(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(x.E,{as:"p",style:{marginBottom:"24px",marginTop:"24px"},children:["Warning: Your Project does not have a Production Domain. We recommend you"," ",(0,n.jsx)(o.Link,{href:`/${Y?Y.slug:q?.username}/${encodeURIComponent(t.name)}/settings/domains`,variant:"highlight",children:"add"})," ","one."]})}),j?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p.h,{y:1}),(0,n.jsx)(r.S,{checked:f,fullWidth:!0,onChange:()=>{v(!f)},children:"Use project's Ignore Build Step"})]}):null,C&&el?(0,n.jsx)("div",{className:"mt-6",children:(0,n.jsx)(F.Ou,{checked:ei,onChange:ea,project:t,rollbackDescription:el})}):null,en&&!C?(0,n.jsx)(h.Note,{className:I()["warning-note"],fill:!0,size:"small",style:{marginTop:24},type:"warning",variant:"contrast",children:(0,n.jsx)(m.B,{align:"center",direction:"row",gap:4,style:{padding:1},children:(0,n.jsx)(m.B,{align:"start",children:(0,n.jsx)(x.E,{as:"p",color:"inherit",children:"This action will undo the current Instant Rollback"})})})}):null]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(E.A,{preset:"body-2",children:["This Deployment will be promoted to ",(0,n.jsx)("strong",{children:"Production"}),"."]}),"production"!==s.target?(0,n.jsx)(E.A,{preset:"body-2",children:"A new deployment will be built using your production environment."}):null,G&&G?.length>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(E.A,{preset:"body-2",children:"The following Domains will point to your new Deployment:"}),(0,n.jsxs)(_.A,{children:[G.slice(0,2).map(({name:e})=>(0,n.jsx)(S.A,{children:(0,n.jsx)($.A,{style:{padding:1===G.length?0:"0 10px"},children:e.startsWith("*")?e:(0,n.jsx)(o.Link,{"data-testid":(0,y.g)("deployments","promote-to-production-overlay","preview-link"),external:!0,href:`https://${e}`,variant:"highlight",children:e})})},e)),G.length>2?(0,n.jsx)(S.A,{children:(0,n.jsx)($.A,{children:(0,n.jsxs)(o.Link,{as:`/${Y?Y.slug:q?.username}/${encodeURIComponent(t.name)}/settings/domains`,href:"/[teamSlug]/[project]/settings/domains",variant:"highlight",children:["...and ",G.length-2," more"]})})}):null]})]}):(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(E.A,{preset:"body-2",children:["Warning: Your Project does not have a Production Domain. We recommend you"," ",(0,n.jsx)(o.Link,{href:`/${Y?Y.slug:q?.username}/${encodeURIComponent(t.name)}/settings/domains`,variant:"highlight",children:"add"})," ","one."]})}),(0,n.jsx)(E.A,{preset:"body-2",children:"Additionally, all Environment Variables defined for the Production Environment in the Project Settings will be applied."}),j?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p.h,{y:.25}),(0,n.jsx)(r.S,{checked:f,fullWidth:!0,onChange:()=>{v(!f)},children:"Use project's Ignore Build Step"}),(0,n.jsx)(P.A,{margin:24})]}):null,(0,n.jsx)(E.A,{preset:"body-2",children:"Are you sure you want to continue?"})]}):(0,n.jsx)(L.default,{center:!0,style:{marginTop:10},children:(0,n.jsx)(c.X,{size:4})}),[eo,er,G,t,Y,q,s,f,j,X,en,el,ei,ea,C]),ec=(0,i.useMemo)(()=>(0,n.jsx)(u.a.Action,{"data-testid":(0,y.g)("deployments","promote-to-production-overlay","confirm-button"),disabled:!!C&&!!el&&!ei,loading:M,onClick:O,children:X&&s&&"target"in s&&"production"===s.target?"Promote":"Promote to Production"}),[O,M,s,X,ei,el,C]);return{modal:(0,i.useMemo)(()=>(0,n.jsxs)(u.a.Modal,{active:l,"data-testid":(0,y.g)("deployments","promote-to-production-overlay"),onAnimationDone:K,onClickOutside:N,sticky:X,width:"500px",children:[(0,n.jsxs)(u.a.Body,{children:[X?null:(0,n.jsx)(u.a.Header,{children:(0,n.jsx)(u.a.Title,{children:"Promote to Production"})}),X?(0,n.jsx)(J,{title:s&&"target"in s&&"production"!==s.target?"Promote to Production":"Promote"}):null,ed,z?(0,n.jsx)(d.$,{error:z}):null]}),(0,n.jsxs)(u.a.Actions,{children:[(0,n.jsx)(u.a.Action,{"data-testid":(0,y.g)("deployments","promote-to-production-overlay","cancel-button"),loading:!1,onClick:N,type:"secondary",children:"Cancel"}),ec]})]}),[ed,N,K,l,ec,z,s,X]),close:N,open:Q,getPromoteTooltip:es}}let Z=({deployment:e,project:t,useIgnoreBuildStep:l,setUseIgnoreBuildStep:n})=>{let o=(0,g.useToasts)(),r=(0,s.useRouter)(),{team:d}=(0,w.dA)(),{user:c}=(0,k.Jd)(),{mutate:u}=(0,C.iX)(),[h,p]=(0,i.useState)(!1),[m,x]=(0,i.useState)(void 0),{readyValue:b}=(0,A.Z_)(),y=(0,R.z)({project:t,deployment:e});return{promote:(0,i.useCallback)(async()=>{if(e&&t){p(!0),x(void 0);try{let n;let i=d?.id,a="Promoted Deployment successfully.";if(b&&"production"===e.target)await (0,f.ff)(`${(0,v.AJS)(t.id,e.uid||e.id)}${(0,j.l)({teamId:i})}`,{method:"POST",body:{},throwOnHTTPError:!0}),n=(0,N.pY)(e,c,d);else{let s=await (0,f.ff)(`${(0,v.SyP)("v13")}${(0,j.l)({teamId:i,skipIgnoreBuildStep:y&&!l?"1":null})}`,{method:"POST",body:JSON.stringify({deploymentId:e.uid||e.id,meta:{action:"promote"},name:t.name,target:"production"}),throwOnHTTPError:!0});n=(0,N.pY)(s,c,d);let o=e.uid||e.id;a="production"===e.target?o===s.id?"Deployment is already the current Production Deployment.":"Promoted Deployment to Production successfully.":"Created Production Deployment successfully."}d&&(u((0,M.n)(t.name,{...O.z,teamId:d.slug})),u((0,M.n)(t.name,{...H.P,teamId:d.slug})),await u((0,W.h)({projectIdOrName:t.id,teamId:d.slug}))),o.success({text:a,key:"production-deployment"}),n&&r.push(n)}catch(e){x((0,a.normalizeError)(e))}finally{p(!1),b||n(V.eb)}}},[e,t,r,n,y,b,d,o,l,c,u]),loading:h,setLoading:p,error:m,setError:x}}},625249:(e,t,l)=>{"use strict";l.d(t,{A:()=>y});var n=l(467926),i=l(88873),a=l(535478),s=l(469916),o=l(400443),r=l(112758);let d=e=>e.props.onClick,c=(e,t)=>{let l=0;return a.Children.map(e,e=>t(e)&&d(e)?(l+=1,a.cloneElement(e,{selectable:!0,even:l%2!=0})):e)},u=({isRowType:e,...t})=>(0,n.jsxs)("tbody",{...t,className:"jsx-bcbab08ca9bd006a "+(t&&null!=t.className&&t.className||""),children:[c(t.children,e),(0,n.jsx)(i,{id:"bcbab08ca9bd006a",children:"tbody.jsx-bcbab08ca9bd006a tr:not(:last-child) td{border-bottom:1px solid var(--accents-2)}thead+tbody.jsx-bcbab08ca9bd006a tr:last-child td{border-bottom:1px solid var(--accents-2)}tbody.jsx-bcbab08ca9bd006a td{color:var(--accents-6);font-size:14px}"})]});u.propTypes={children:o.node};var h=l(9055),p=l(936895);function m(e,t){if(e){let l=[];return a.Children.forEach(e,(e,n)=>{t&&t.call(this,e,n)&&l.push(e)}),l}return[]}let x=({children:e,className:t="",isHeadType:l=b,isRowType:a=g,innerRef:o,...d})=>{let c=m(e,e=>(0,r.A)("col",e)),h=m(e,l),p=m(e,a);return(0,n.jsxs)("table",{...d,ref:o,className:"jsx-7617ac1a595cd721 "+((0,s.$)("table",t)||""),children:[c.length>0&&(0,n.jsx)("colgroup",{className:"jsx-7617ac1a595cd721",children:c}),h.length>0&&(0,n.jsx)("thead",{className:"jsx-7617ac1a595cd721",children:h}),(0,n.jsx)(u,{isRowType:a,children:p}),(0,n.jsx)(i,{id:"7617ac1a595cd721",children:"table.jsx-7617ac1a595cd721{border-collapse:separate;border-spacing:0;width:100%}table.jsx-7617ac1a595cd721 td:nth-child(1){border-left:1px solid transparent}table.jsx-7617ac1a595cd721 td:last-child{border-right:1px solid transparent}thead.jsx-7617ac1a595cd721 th:nth-child(1){border-bottom:1px solid var(--accents-2);border-left:1px solid var(--accents-2);-webkit-border-radius:6px 0px 0px 6px;-moz-border-radius:6px 0px 0px 6px;border-radius:6px 0px 0px 6px;border-top:1px solid var(--accents-2)}thead.jsx-7617ac1a595cd721 th:last-child{border-bottom:1px solid var(--accents-2);-webkit-border-radius:0 6px 6px 0;-moz-border-radius:0 6px 6px 0;border-radius:0 6px 6px 0;border-right:1px solid var(--accents-2);border-top:1px solid var(--accents-2)}thead.jsx-7617ac1a595cd721 th{background:var(--accents-1);border-bottom:1px solid var(--accents-2);border-top:1px solid var(--accents-2)}table.jsx-7617ac1a595cd721 th,table.jsx-7617ac1a595cd721 td{padding:0 10px;text-align:left;vertical-align:top}table.jsx-7617ac1a595cd721 th>div{-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;min-height:40px;font-size:12px}table.jsx-7617ac1a595cd721 td>div{-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;min-height:50px;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-flow:row wrap;-moz-box-orient:horizontal;-moz-box-direction:normal;-ms-flex-flow:row wrap;flex-flow:row wrap}table.jsx-7617ac1a595cd721 td.multi-line>div{min-height:none;padding:14px 0}table.jsx-7617ac1a595cd721 th{color:var(--accents-5);font-size:14px;font-weight:400;letter-spacing:0}table.jsx-7617ac1a595cd721 th.right>div,table.jsx-7617ac1a595cd721 td.right>div{-webkit-box-pack:end;-webkit-justify-content:flex-end;-moz-box-pack:end;-ms-flex-pack:end;justify-content:flex-end}table.jsx-7617ac1a595cd721 th.center>div,table.jsx-7617ac1a595cd721 td.center>div{-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center}table.jsx-7617ac1a595cd721 tr.disabled{pointer-events:none;opacity:.6}table.jsx-7617ac1a595cd721 tr.selectable{cursor:pointer}table.jsx-7617ac1a595cd721 tr.selectable:hover{background-color:#fcfcfc}@media(min-width:1024px){table.jsx-7617ac1a595cd721 td.instances-url{min-width:360px}}"})]})},g=e=>(0,r.A)(p.A,e),b=e=>(0,r.A)(h.A,e);x.propTypes={children:o.node,className:o.string,isHeadType:o.func,isRowType:o.func};let y=x},656929:(e,t,l)=>{"use strict";l.d(t,{A:()=>d});var n=l(467926),i=l(535478),a=l(469916),s=l(400443),o=l(298949),r=l(112758);class d extends i.Component{static{this.propTypes={align:s.oneOf(["left","center","right"]),children:s.node,className:s.string,disabled:s.bool,innerRef:s.func,onClick:s.func,sorted:s.oneOf(["asc","desc"]),tagName:s.oneOf(["td","th"]),value:s.any}}static{this.defaultProps={tagName:"td"}}render(){let{align:e,children:t,className:l,innerRef:s,disabled:d,sorted:c,tagName:u,...h}=this.props;return(0,i.createElement)(u,{...h,className:(0,a.$)("table-cell",{"head-cell":"th"===u,"row-cell":"td"===u,right:"right"===e,center:"center"===e,sorted:c,disabled:d},l),ref:s,onClick:this.handleClick},(0,r.A)("div",t)?t:(0,i.createElement)("div",{},t,c&&(0,n.jsx)(o.y,{})))}constructor(...e){super(...e),this.handleClick=e=>{this.props.onClick&&this.props.onClick(e,this.props.value)}}}},658855:(e,t,l)=>{"use strict";l.d(t,{l:()=>i});var n=l(801044);async function i(e,{attributes:t,req:l,statusCode:a}={}){if(404===a)return Promise.resolve();l?.headers&&(l.headers.cookie="xxxxx hidden for security xxxxx"),(0,n.Cp)(e,{attributes:{...t,status_code:a,"http.method":l?.method,"http.status_code":a&&a>99?a:void 0,request_url:l?.url}})}},696692:(e,t,l)=>{"use strict";l.d(t,{A:()=>i});var n=l(535478);function i(e=""){let[t,l]=(0,n.useState)(!1),a=window.location.hash,s=e.startsWith("#")?e:`#${e}`;return(0,n.useEffect)(()=>{let e=()=>{window.location.hash!==s||t||l(!0)};return window.addEventListener("hashchange",e),()=>{window.removeEventListener("hashchange",e)}},[t,s]),a!==s||t||(l(!0),window.history.replaceState(null,""," ")),a!==s&&t&&(window.location.hash=s),[t,l]}},765824:e=>{e.exports={button:"custom_button__pUskI"}},818289:(e,t,l)=>{"use strict";l.d(t,{A:()=>c});var n=l(467926),i=l(535478),a=l(592344),s=l(768970),o=l(343949),r=l(582892),d=l(266565);let c=(0,i.memo)(({active:e,url:t,onCancel:l})=>{let[c,u]=(0,i.useState)(""),h=(0,i.useMemo)(()=>!c||c.includes(".")||!(0,a.isValid)(`${c}.${t}`),[c,t]),p=(0,i.useCallback)(()=>{u(""),l()},[l]),m=(0,i.useCallback)(e=>{e.preventDefault(),window.open((0,d.t)(`${c}.${t}`),"_blank","noopener"),p()},[c,t,p]);return t?(0,n.jsx)(o.a,{active:e,onClickOutside:p,children:(0,n.jsxs)("form",{onSubmit:m,children:[(0,n.jsxs)(o.a.Body,{children:[(0,n.jsx)(o.a.Title,{children:"Wildcard Domain"}),(0,n.jsx)(r.h,{}),(0,n.jsx)(o.a.Subtitle,{children:"Enter a subdomain to visit below."}),(0,n.jsx)(r.h,{y:.75}),(0,n.jsx)(s.Input,{autoFocus:!0,id:"hostname",label:"Hostname",onChange:e=>u(e.target.value),suffix:`.${t}`,value:c})]}),(0,n.jsxs)(o.a.Actions,{children:[(0,n.jsx)(o.a.Action,{onClick:l,children:"Cancel"}),(0,n.jsx)(o.a.Action,{buttonType:"submit",disabled:h,children:"Visit"})]})]})}):null})},847355:e=>{e.exports={loading:"loading-dots_loading___JiwF",spacer:"loading-dots_spacer__ZqLUW",blink:"loading-dots_blink__QxiP8"}},936895:(e,t,l)=>{"use strict";l.d(t,{A:()=>s});var n=l(467926),i=l(535478),a=l(469916);let s=({ariaRole:e="row",children:t,className:l="",disabled:s=!1,onClick:o,selectable:r=!1,...d})=>(0,n.jsx)("tr",{"aria-roledescription":e,className:(0,a.$)("row",{selectable:r,disabled:s},l),onClick:o,...d,children:i.Children.map(t,e=>e?(0,i.cloneElement)(e,{tagName:"td"}):null)})},937564:e=>{e.exports={aliasLink:"aliases_aliasLink__0Gzx9"}}}]);
//# debugId=c3ad1b70-2a29-5d4b-a7be-410b34d2fc6c
